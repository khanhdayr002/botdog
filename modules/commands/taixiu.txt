module.exports.config = {
  name: "taixiu",
  version: "1.0.0",
  hasPermssion: 0,
  credits: "khoa",
  description: "ChÆ¡i tÃ i xá»‰u má»™t ngÆ°á»i Ä‘áº·t, khÃ´ng dÃ¹ng api",
  commandCategory: "Game",
  usages: '[tÃ i/xá»‰u hoáº·c cháºµn/láº»] [sá»‘ tiá»n]\nDÃ¹ng "taixiu luáº­t chÆ¡i" Ä‘á»ƒ biáº¿t luáº­t chÆ¡i!',
  cooldowns: 5
};

module.exports.onLoad = () => {
  const fs = require("fs-extra");
  const request = require("request");
  const dirMaterial = __dirname + `/cache/`;
  if (!fs.existsSync(dirMaterial + "cache")) fs.mkdirSync(dirMaterial, { recursive: true });
  if (!fs.existsSync(dirMaterial + "icontaixiu.png")) request("https://i.postimg.cc/ydh7gfLg/icontaixiu.png").pipe(fs.createWriteStream(dirMaterial + "icontaixiu.png"));
}

module.exports.run = async function ({
  api,
  event,
  args,
  Currencies,
  Users
}) {

  // Loli is the best!!

  const { loadImage, createCanvas } = require("canvas");
  const fs = global.nodemodule["fs-extra"];
  const axios = global.nodemodule["axios"];
  let pathImg = __dirname + "/cache/bkdia.png";
  let pathXn1 = __dirname + "/cache/xingaum.png";
  let pathXn2 = __dirname + "/cache/xingauh.png";
  let pathXn3 = __dirname + "/cache/xingaub.png";

  var { threadID, messageID, senderID } = event;
  const dataMoney = await Currencies.getData(senderID);
  const money = dataMoney.money;
  if (args.length !== 2) return api.sendMessage({body: "ğŸ²==== [ ğ—§ğ—”Ì€ğ—œ ğ—«ğ—œÌ‰ğ—¨ ] ====ğŸ²\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\nğŸ®ğ—›ğ˜‚Ì›ğ—¼Ì›Ìğ—»ğ—´ ğ——ğ—®Ì‚Ìƒğ—» ğ—¦ğ˜‚Ì›Ì‰ ğ——ğ˜‚Ì£ğ—»ğ—´ğŸ®\n\nğŸ­. ğ—§ğ—®ğ—¶ğ˜…ğ—¶ğ˜‚ + ğ˜ğ—®Ì€ğ—¶ ğ—¼ğ—¿ ğ˜…ğ—¶Ì‰ğ˜‚ + ğ˜€ğ—¼Ì‚Ì ğ˜ğ—¶ğ—²Ì‚Ì€ğ—» ğ—°ğ˜‚Ì›ğ—¼Ì›Ì£ğ—° ğ˜ğ—¿ğ—²Ì‚ğ—» ğŸ­ğŸ¬ğŸ¬ (ğ˜ƒğ—±: ?ğ˜ğ—®ğ—¶ğ˜…ğ—¶ğ˜‚ ğ˜ğ—®Ì€ğ—¶ ğŸ®ğŸ¬ğŸ¬)\nğŸ®. ğ—§ğ—®ğ—¶ğ˜…ğ—¶ğ˜‚ + ğ—°ğ—µğ—®Ì†Ìƒğ—» ğ—¼ğ—¿ ğ—¹ğ—²Ì‰ + ğ˜€ğ—¼Ì‚Ì ğ˜ğ—¶ğ—²Ì‚Ì€ğ—» ğ—°ğ˜‚Ì›ğ—¼Ì›Ì£ğ—° ğ˜ğ—¿ğ—²Ì‚ğ—» ğŸ­ğŸ¬ğŸ¬ (ğ˜ƒğ—±: ?ğ˜ğ—®ğ—¶ğ˜…ğ—¶ğ˜‚ ğ—¹ğ—²Ì‰ ğŸ®ğŸ¬ğŸ¬)\n\nâš ï¸ğ—Ÿğ˜‚Ì›ğ˜‚ ğ˜†Ì ğ—»ğ—²Ì‚Ìğ˜‚ ğ—¯ğ—®Ì£ğ—» ğ—°ğ—¼Ì‚Ì ğ˜ğ—¶Ì€ğ—»ğ—µ ğ˜€ğ—½ğ—®ğ—º ğ˜ğ—®Ì€ğ—¶ ğ˜…ğ—¶Ì‰ğ˜‚ ğ—µğ—²Ì£Ì‚ ğ˜ğ—µğ—¼Ì‚Ìğ—»ğ—´ ğ˜€ğ—²Ìƒ ğ—¯ğ—®ğ—» ğ—¯ğ—®Ì£ğ—»!!!",attachment: (await global.nodemodule["axios"]({
url: (await global.nodemodule["axios"]('https://Api-By-Nhhoang.vnhoang06.repl.co/taixiu')).data.url,
method: "GET",
responseType: "stream"
})).data
},event.threadID, event.messageID);

  if (event.body.indexOf("luáº­t chÆ¡i") !== -1) {
    var msg = {
      body: "cÃ¡ch chÆ¡i chÆ°a Ä‘Æ°á»£c update...",
      attachment: fs.createReadStream(__dirname + `/cache/icontaixiu.png`)
    }
    return api.sendMessage(msg, threadID, messageID);
  }

  var datcuoc = args[0].toLowerCase();
  var tiencuoc = parseInt(args[1]);
  if (datcuoc !== 'tÃ i' && (datcuoc !== 'xá»‰u' && (datcuoc !== 'cháºµn' && (datcuoc !== 'láº»')))) return api.sendMessage(`Äáº·t cÆ°á»£c tÃ i/xá»‰u hoáº·c cháºµn/láº» thÃ´i, ${datcuoc} lÃ  cc gÃ¬ tháº¿!`, threadID, messageID);
  if (tiencuoc < 100) return api.sendMessage("â†’ ğ—§ğ—¶ğ—²Ì‚Ì€ğ—» ğ—°ğ˜‚Ì›ğ—¼Ì›Ì£ğ—° ğ—¾ğ˜‚ğ—®Ì ğ—¶Ìğ˜ ğ˜ğ—®ğ—¼ ğ—¸ğ—µğ—¼Ì‚ğ—»ğ—´ ğ—°ğ—µğ—®Ì‚Ìğ—½ ğ—»ğ—µğ—®Ì£Ì‚ğ—»!", threadID, messageID);
  if (isNaN(tiencuoc)) return api.sendMessage("â†’ ğ—§ğ—¶ğ—²Ì‚Ì€ğ—» ğ—°ğ˜‚Ì›ğ—¼Ì›Ì£ğ—° ğ—½ğ—µğ—®Ì‰ğ—¶ ğ—¹ğ—®Ì€ ğ—ºğ—¼Ì£Ì‚ğ˜ ğ—°ğ—¼ğ—» ğ˜€ğ—¼Ì‚Ì!", threadID, messageID);
  if (tiencuoc > money) return api.sendMessage(`â†’ ğ—•ğ—®Ì£ğ—» ğ—¸ğ—µğ—¼Ì‚ğ—»ğ—´ ğ—°ğ—¼Ì Ä‘ğ˜‚Ì‰ ${tiencuoc}$ Ä‘ğ—²Ì‚Ì‰ ğ—°ğ—µğ—¼Ì›ğ—¶, ğ˜ƒğ˜‚ğ—¶ ğ—¹ğ—¼Ì€ğ—»ğ—´ ğ˜ğ—µğ—²ğ—¼ ğ˜ğ—µğ—®Ì‚Ì€ğ˜† ğ—›ğ˜‚ğ—®Ì‚Ìğ—» ğ—¯ğ˜‚Ì›ğ—¼Ì›ğ—» ğ—°ğ—µğ—®Ì‰ğ—¶`, threadID, messageID);

  api.sendMessage("â†’ Äğ—®ğ—»ğ—´ ğ—¹ğ—®Ì†Ìğ—° ğ˜…ğ—¶ğ—» ğ˜ƒğ˜‚ğ—¶ ğ—¹ğ—¼Ì€ğ—»ğ—´ ğ—°ğ—µğ—¼Ì›Ì€ ğŸ®ğ˜€...", threadID, messageID);

  var xnmot = Math.floor(Math.random() * 6) + 1;
  var xnhai = Math.floor(Math.random() * 6) + 1;
  var xnba = Math.floor(Math.random() * 6) + 1;
  var tong = xnmot + xnhai + xnba;

  if (datcuoc == 'tÃ i' || (datcuoc == 'xá»‰u')) {
    if (xnmot == xnhai && xnmot == xnba) {
      var ketqua = 'thua'; 
    }
    else {
      if (tong >= 4 && (tong <= 10)) var ketqua = 'xá»‰u';
    if (tong >= 11 && (tong <= 17)) var ketqua = 'tÃ i';
    }
  };

  if (datcuoc == 'cháºµn' || (datcuoc == 'láº»')) {
    if (tong % 2 == 0) var ketqua = 'cháºµn';
    else var ketqua = 'láº»';
  };

  if (xnmot == 1) var link1 = `https://i.postimg.cc/c1mGP3CX/x-ng-u-1.png`
  if (xnmot == 2) var link1 = `https://i.postimg.cc/pr2bpWGf/x-ng-u-2.png`
  if (xnmot == 3) var link1 = `https://i.postimg.cc/d0dz6kgR/x-ng-u-3.png`
  if (xnmot == 4) var link1 = `https://i.postimg.cc/52Dh8qKN/x-ng-u-4.png`
  if (xnmot == 5) var link1 = `https://i.postimg.cc/76nj8vHf/x-ng-u-5.png`
  if (xnmot == 6) var link1 = `https://i.postimg.cc/j5bBFqrp/x-ng-u-6.png`

  if (xnhai == 1) var link2 = `https://i.postimg.cc/c1mGP3CX/x-ng-u-1.png`
  if (xnhai == 2) var link2 = `https://i.postimg.cc/pr2bpWGf/x-ng-u-2.png`
  if (xnhai == 3) var link2 = `https://i.postimg.cc/d0dz6kgR/x-ng-u-3.png`
  if (xnhai == 4) var link2 = `https://i.postimg.cc/52Dh8qKN/x-ng-u-4.png`
  if (xnhai == 5) var link2 = `https://i.postimg.cc/76nj8vHf/x-ng-u-5.png`
  if (xnhai == 6) var link2 = `https://i.postimg.cc/j5bBFqrp/x-ng-u-6.png`

  if (xnba == 1) var link3 = `https://i.postimg.cc/c1mGP3CX/x-ng-u-1.png`
  if (xnba == 2) var link3 = `https://i.postimg.cc/pr2bpWGf/x-ng-u-2.png`
  if (xnba == 3) var link3 = `https://i.postimg.cc/d0dz6kgR/x-ng-u-3.png`
  if (xnba == 4) var link3 = `https://i.postimg.cc/52Dh8qKN/x-ng-u-4.png`
  if (xnba == 5) var link3 = `https://i.postimg.cc/76nj8vHf/x-ng-u-5.png`
  if (xnba == 6) var link3 = `https://i.postimg.cc/j5bBFqrp/x-ng-u-6.png`

  var color = [
    "https://i.postimg.cc/mggtbQLy/green.png",
    "https://i.postimg.cc/Gmg99H9w/lightblue.png",
    "https://i.postimg.cc/PqLJDT8L/lightgreen.png",
    "https://i.postimg.cc/26h5HGGr/luzaly.png",
    "https://i.postimg.cc/90BQ2fsk/orange.png",
    "https://i.postimg.cc/T2jwgkhc/pantone.png",
    "https://i.postimg.cc/1zLtc2pv/pink.png",
    "https://i.postimg.cc/2yYSgW9v/red.png",
    "https://i.postimg.cc/DwXR4Nwv/yellow.png",
    "https://i.postimg.cc/y8zQbyHn/violet.png"
  ];
  var background = color[Math.floor(Math.random() * color.length)];

  // Äá»‘ng link trÃªn bá»‹ lá»—i thÃ¬ liÃªn há»‡ https://www.facebook.com/khoa.lolicon/ Ä‘á»ƒ láº¥y áº£nh.

  let Xingaum = (
    await axios.get(
      `${link1}`,
      { responseType: "arraybuffer" }
    )
  ).data;
  fs.writeFileSync(pathXn1, Buffer.from(Xingaum, "utf-8"));

  let Xingauh = (
    await axios.get(
      `${link2}`,
      { responseType: "arraybuffer" }
    )
  ).data;
  fs.writeFileSync(pathXn2, Buffer.from(Xingauh, "utf-8"));

  let Xingaub = (
    await axios.get(
      `${link3}`,
      { responseType: "arraybuffer" }
    )
  ).data;
  fs.writeFileSync(pathXn3, Buffer.from(Xingaub, "utf-8"));

  let getBkdia = (
    await axios.get(`${background}`, {
      responseType: "arraybuffer",
    })
  ).data;
  fs.writeFileSync(pathImg, Buffer.from(getBkdia, "utf-8"));

  let baseImage = await loadImage(pathImg);
  let baseXn1 = await loadImage(pathXn1);
  let baseXn2 = await loadImage(pathXn2);
  let baseXn3 = await loadImage(pathXn3);
  let canvas = createCanvas(baseImage.width, baseImage.height);
  let ctx = canvas.getContext("2d");
  ctx.drawImage(baseImage, 0, 0, canvas.width, canvas.height);
  ctx.drawImage(baseXn1, 200, 150, 100, 100);
  ctx.drawImage(baseXn2, 280, 150, 100, 100);
  ctx.drawImage(baseXn3, 250, 220, 100, 100);
  const imageBuffer = canvas.toBuffer();
  fs.writeFileSync(pathImg, imageBuffer);
  fs.removeSync(pathXn1);
  fs.removeSync(pathXn2);
  fs.removeSync(pathXn3);

  if (ketqua == 'thua') {
    Currencies.decreaseMoney(senderID, tiencuoc);
    return api.sendMessage({ body: `=== ã€ ğ—¬ğ—¢ğ—¨ ğ—Ÿğ—¢ğ—¦ğ—˜ ã€ ====\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâ†’ ğ—«ğ—¶Ì ğ—»ğ—´ğ—®Ì‚Ì€ğ˜‚ ğ—¿ğ—®: ${xnmot}, ${xnhai} ğ˜ƒğ—®Ì€ ${xnba}\nâ†’ ğ—•ğ—® ğ˜…ğ—¶Ì ğ—»ğ—´ğ—®Ì‚Ì€ğ˜‚ ğ—¯ğ—®Ì†Ì€ğ—»ğ—´ ğ—»ğ˜‚Ìğ˜ ğ—»ğ—²Ì‚ğ—» ğ—°ğ—®Ì‰ ğ˜ğ—®Ì€ğ—¶ ğ˜ƒğ—®Ì€ ğ˜…ğ—¶Ì‰ğ˜‚ Ä‘ğ—²Ì‚Ì€ğ˜‚ ğ˜ğ—µğ˜‚ğ—® ğ˜€ğ—ºğ—¹! ğŸ­`, attachment: fs.createReadStream(pathImg) },
      threadID,
      () => fs.unlinkSync(pathImg),
      messageID);
  }
  else if (ketqua == datcuoc) {
    Currencies.increaseMoney(senderID, tiencuoc);
    return api.sendMessage({ body: `=== ã€ ğ—¬ğ—¢ğ—¨ ğ—ªğ—œğ—¡ ã€ ====\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâ†’ ğ—«ğ—¶Ì ğ—»ğ—´ğ—®Ì‚Ì€ğ˜‚ ğ—¿ğ—®: ${xnmot}, ${xnhai} ğ˜ƒğ—®Ì€ ${xnba}\nâ†’ ğ—§ğ—¼Ì‚Ì‰ğ—»ğ—´ ğ—¹ğ—®Ì€ ${tong} ğ—»ğ˜‚Ìğ˜\nâ†’ ğ—ğ—²Ì‚Ìğ˜ ğ—¾ğ˜‚ğ—®Ì‰ ğ—¹ğ—®Ì€ ${ketqua} \nâ†’ ğ—•ğ—®Ì£ğ—» ğ˜ğ—µğ—®Ì†Ìğ—»ğ—´! +${tiencuoc}$`, attachment: fs.createReadStream(pathImg) },
      threadID,
      () => fs.unlinkSync(pathImg),
      messageID);
  }
  else {
    Currencies.decreaseMoney(senderID, tiencuoc);
    return api.sendMessage({ body: `=== ã€ ğ—¬ğ—¢ğ—¨ ğ—Ÿğ—¢ğ—¦ğ—˜ ã€ ====\nâ”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\nâ†’ ğ—«ğ—¶Ì ğ—»ğ—´ğ—®Ì‚Ì€ğ˜‚ ğ—¿ğ—®: ${xnmot}, ${xnhai} ğ˜ƒğ—®Ì€ ${xnba}\nâ†’ ğ—§ğ—¼Ì‚Ì‰ğ—»ğ—´ ğ—¹ğ—®Ì€ ${tong} ğ—»ğ˜‚Ìğ˜\nâ†’ ğ—ğ—²Ì‚Ìğ˜ ğ—¾ğ˜‚ğ—®Ì‰ ğ—¹ğ—®Ì€ ${ketqua} \nâ†’ ğ—•ğ—®Ì£ğ—» ğ˜ğ—µğ˜‚ğ—® ğ˜€ğ—ºğ—¹ -${tiencuoc}$`, attachment: fs.createReadStream(pathImg) },
      threadID,
      () => fs.unlinkSync(pathImg),
      messageID);
  };
}

